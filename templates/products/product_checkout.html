{% extends 'base.html' %}

{% block content %}
    <main class="main">
        <div class="section block-breadcrumb">
            <div class="container">
                <div class="breadcrumbs">
                    <ul>
                        <li><a href="{% url 'homepage' %}">Главная </a></li>
                        <li><a href="{% url 'products:product_cart' %}">Корзина </a></li>
                        <li><a href="{% url 'products:product_checkout' %}">Оформление заказа </a></li>
                    </ul>
                </div>
            </div>
        </div>
        <section class="section block-cart">
            <div class="container">
                <div class="mb-100 mt-60">
                    <div class="box-customer-login">
                        Постоянный клиент? <a href="{% url "users:login" %}">Нажми сюда чтобы войти</a>
                    </div>


                    <div class="row mt-30">
                        <!-- Левая колонка - Форма оформления заказа -->
                        <div class="col-lg-6">
                            <h4 class="mb-25">Контактная информация</h4>
                            <div class="box-form-checkout">
                                <form method="POST" class="checkout-form form-comment">
                                    {% csrf_token %}

                                    <div class="form-group">
                                    <p>ФИО:</p>
                                        {{ form.full_name }}
                                        {% if form.full_name.errors %}
                                            <div class="text-danger mt-2">{{ form.full_name.errors }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="form-group">
                                    <p>Email:</p>
                                        {{ form.email }}
                                        {% if form.email.errors %}
                                            <div class="text-danger mt-2">{{ form.email.errors }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="form-group">
                                    <p>Контактный номер:</p>
                                        {{ form.phone }}
                                        {% if form.phone.errors %}
                                            <div class="text-danger mt-2">{{ form.phone.errors }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="form-group">
                                    <p>Адрес доставки:</p>
                                        {{ form.address }}
                                        {% if form.address.errors %}
                                            <div class="text-danger mt-2">{{ form.address.errors }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="form-group mt-30">
                                        <button type="submit" class="btn btn-black btn-lg w-100">Оформить заказ</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Правая колонка - Информация о заказе -->
                        <div class="col-lg-6">
                            <div class="box-detail-cart">
                                <h4 class="mb-25">Ваш заказ</h4>
                                <div class="box-info-cart">
                                    <p class="text-17-medium text-uppercase mb-15">Товары</p>
                                    <div class="box-info-checkout-inner">
                                        {% for item in cart_items %}
                                            <div class="list-items-cart mb-15">
                                                <div class="item-cart">
                                                    <div class="item-cart-image">
                                                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                                                    </div>
                                                    <div class="item-cart-info">
                                                        <div class="item-cart-info-1">
                                                            <a class="text-17-medium" href="#">{{ item.product.name }}</a>
                                                            <p class="body-p2 neutral-medium-dark">Количество: {{ item.quantity }}</p>
                                                        </div>
                                                        <div class="item-cart-info-2">
                                                            <p class="body-p2">₽ {{ item.product.price }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>

                                    <div class="box-info-cart-inner mt-20">
                                        <p class="text-17-medium text-uppercase mb-15 neutral-medium-dark">Доставка</p>
                                        <div class="list-radio">
                                            <div class="item-radio">
                                                <label>
                                                    <input
                                                        type="radio"
                                                        name="shipping"
                                                        value=""
                                                        {% if not request.GET.shipping %}checked{% endif %}
                                                        onchange="handleShippingChange(this)"
                                                    >
                                                    Не выбрано
                                                </label>
                                            </div>
                                            <div class="item-radio">
                                                <label>
                                                    <input
                                                        type="radio"
                                                        name="shipping"
                                                        value="direct"
                                                        {% if request.GET.shipping == 'direct' %}checked{% endif %}
                                                        onchange="handleShippingChange(this)"
                                                    >
                                                    Прямая доставка: ₽ {{ shipping_price.direct }}
                                                </label>
                                            </div>
                                            <div class="item-radio">
                                                <label>
                                                    <input
                                                        type="radio"
                                                        name="shipping"
                                                        value="pickup"
                                                        {% if request.GET.shipping == 'pickup' %}checked{% endif %}
                                                        onchange="handleShippingChange(this)"
                                                    >
                                                    Самовывоз: ₽ {{ shipping_price.pickup }}
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <script>
                                        function handleShippingChange(radio) {
                                            const url = new URL(window.location);
                                            if (radio.value) {
                                                url.searchParams.set('shipping', radio.value);
                                            } else {
                                                url.searchParams.delete('shipping');
                                            }
                                            window.location.href = url.toString();
                                        }
                                    </script>

                                    <div class="d-flex align-items-center justify-content-between box-border-bottom mt-20 pt-20">
                                        <h5 class="neutral-medium-dark">Общая стоимость</h5>
                                        <h5 class="color-9">₽ {{ total_price }}</h5>
                                    </div>

{#                                    <div class="mt-20">#}
{#                                        <p class="text-17-medium text-uppercase mb-15 neutral-medium-dark">Способ оплаты</p>#}
{#                                        <div class="list-radio">#}
{#                                            <div class="item-radio">#}
{#                                                <label>#}
{#                                                    <input type="radio" name="payment" checked="checked">Банковской картой#}
{#                                                </label>#}
{#                                            </div>#}
{#                                            <div class="item-radio">#}
{#                                                <label>#}
{#                                                    <input type="radio" name="payment">СБП#}
{#                                                </label>#}
{#                                            </div>#}
{#                                            <div class="item-radio">#}
{#                                                <label>#}
{#                                                    <input type="radio" name="payment">Наличными курьеру#}
{#                                                </label>#}
{#                                            </div>#}
{#                                            <div class="item-radio">#}
{#                                                <label>#}
{#                                                    <input type="radio" name="payment">Рассрочкой под 0%#}
{#                                                </label>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </div>#}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
{% endblock %}
